<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Practical Machine Learning by fatzh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Practical Machine Learning</h1>
      <h2 class="project-tagline">Peer assessment project</h2>
      <a href="https://github.com/fatzh/PracticalMachineLearning-PeerAssignment" class="btn">View on GitHub</a>
      <a href="https://github.com/fatzh/PracticalMachineLearning-PeerAssignment/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/fatzh/PracticalMachineLearning-PeerAssignment/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement â€“ a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In this project, our goal is to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways (exercise class). We will build a model to predict the exercise class based on the data from the accelerometers.</p>

<h2>
<a id="data" class="anchor" href="#data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data</h2>

<div class="highlight highlight-source-r"><pre><span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-s"><span class="pl-pds">"</span>./data/pml-training.csv<span class="pl-pds">"</span></span>)) {
    download.file(<span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv<span class="pl-pds">"</span></span>, 
        <span class="pl-s"><span class="pl-pds">"</span>./data/pml-training.csv<span class="pl-pds">"</span></span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>curl<span class="pl-pds">'</span></span>)
}
<span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-s"><span class="pl-pds">"</span>./data/pml-testing.csv<span class="pl-pds">"</span></span>)) {
    download.file(<span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv<span class="pl-pds">"</span></span>, 
        <span class="pl-s"><span class="pl-pds">"</span>./data/pml-testing.csv<span class="pl-pds">"</span></span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>curl<span class="pl-pds">'</span></span>)
}

<span class="pl-smi">df_train_base</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">'</span>./data/pml-training.csv<span class="pl-pds">'</span></span>, <span class="pl-v">sep</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>, <span class="pl-v">stringsAsFactors</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>, <span class="pl-v">strip.white</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">df_test_base</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">'</span>./data/pml-testing.csv<span class="pl-pds">'</span></span>, <span class="pl-v">sep</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>, <span class="pl-v">strip.white</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>, <span class="pl-v">stringsAsFactors</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)</pre></div>

<p>We set an initial seed to ensure this analysis can be reproduced:</p>

<div class="highlight highlight-source-r"><pre>set.seed(<span class="pl-c1">123</span>)</pre></div>

<h2>
<a id="exploratory-analysis" class="anchor" href="#exploratory-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exploratory Analysis</h2>

<p>The training set contains 19622 observations and 160 features. We can see that some features are only present for some observations. These observations correspond to observations windows where the data from the sensors is being derived (average, variance, etc..). The windows last 0.5 seconds to 2.5 seconds and correspond to one exercise class. This approach taken by the research team can not be used for our problem as the observations we have to predict are instantaneous measurements.</p>

<p>We can therefore clean up the dataset by removing all the derived data generated by the research team for their window based approach. Also the time related data are not relevant for our exercise as we're looking to classify instatanous measurements. Finally, the name of the participant and the X feature are also irrelevant.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">df_train</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">df_train_base</span> %<span class="pl-k">&gt;</span>%
    select(<span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>avg_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>var_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>stddev_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>max_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>min_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>amplitude_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>kurtosis_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span>starts_with(<span class="pl-s"><span class="pl-pds">"</span>skewness_<span class="pl-pds">"</span></span>),
           <span class="pl-k">-</span><span class="pl-smi">new_window</span>,
           <span class="pl-k">-</span><span class="pl-smi">num_window</span>,
           <span class="pl-k">-</span><span class="pl-smi">user_name</span>,
           <span class="pl-k">-</span><span class="pl-smi">raw_timestamp_part_1</span>,
           <span class="pl-k">-</span><span class="pl-smi">raw_timestamp_part_2</span>,
           <span class="pl-k">-</span><span class="pl-smi">cvtd_timestamp</span>,
           <span class="pl-k">-</span><span class="pl-smi">X</span>)
dim(<span class="pl-smi">df_train</span>)</pre></div>

<pre><code>## [1] 19622    53
</code></pre>

<p>We are now left with 52 features corresponding to instantaneous measurements of the sensors installed on the participants and the exercise class.</p>

<p>The output is the class and must be converted to a factor:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">df_train</span><span class="pl-k">$</span><span class="pl-smi">classe</span> <span class="pl-k">&lt;-</span> as.factor(<span class="pl-smi">df_train</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)</pre></div>

<h2>
<a id="training" class="anchor" href="#training" aria-hidden="true"><span class="octicon octicon-link"></span></a>Training</h2>

<p>We will split the training set to keep a test set on the side in order to estimate the performances of our models. Here the split is to keep 70% of the data for training, and the remaining 30% for testing. We will use the testing set to estimate the out-of-sample accuracy of our model.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">inTrain</span> <span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">df_train</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-v">p</span><span class="pl-k">=</span><span class="pl-c1">0.7</span>, <span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">df_train</span>[<span class="pl-smi">inTrain</span>, ]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">df_train</span>[<span class="pl-k">-</span><span class="pl-smi">inTrain</span>,]</pre></div>

<p>We can now train a random forest model, using a 3-fold cross validation to determine the best parameters.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">myTrainControl</span> <span class="pl-k">&lt;-</span> trainControl(<span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>cv<span class="pl-pds">"</span></span>, <span class="pl-v">number</span><span class="pl-k">=</span><span class="pl-c1">3</span>)
<span class="pl-smi">modFit</span> <span class="pl-k">&lt;-</span> train(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>rf<span class="pl-pds">"</span></span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">training</span>, <span class="pl-v">prox</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">trControl</span> <span class="pl-k">=</span> <span class="pl-smi">myTrainControl</span>)</pre></div>

<p>The final model:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">modFit</span><span class="pl-k">$</span><span class="pl-smi">finalModel</span></pre></div>

<pre><code>## 
## Call:
##  randomForest(x = x, y = y, mtry = param$mtry, proximity = TRUE) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 0.71%
## Confusion matrix:
##      A    B    C    D    E  class.error
## A 3905    1    0    0    0 0.0002560164
## B   19 2632    7    0    0 0.0097817908
## C    0   20 2374    2    0 0.0091819699
## D    0    0   39 2211    2 0.0182060391
## E    0    0    2    6 2517 0.0031683168
</code></pre>

<p>We can see that some observations has been missclassified, the error rate of the model using cross validation is 0.71%, meaning an accuracy of more than 99%. This is really good and we can think that our model may be overfitting the training data.</p>

<p>To estimate more realistically the out-of-sample error of our model, we can now use the testing set that we defined earlier. Let's predict the classes of the testing observations and compare to their real values.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">pred</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modFit</span>, <span class="pl-smi">testing</span>)
confusionMatrix(table(<span class="pl-smi">pred</span>, <span class="pl-smi">testing</span><span class="pl-k">$</span><span class="pl-smi">classe</span>))</pre></div>

<pre><code>## Confusion Matrix and Statistics
## 
##     
## pred    A    B    C    D    E
##    A 1673    7    0    0    0
##    B    1 1131   14    0    0
##    C    0    1 1011   20    0
##    D    0    0    1  943    0
##    E    0    0    0    1 1082
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9924          
##                  95% CI : (0.9898, 0.9944)
##     No Information Rate : 0.2845          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9903          
##  Mcnemar's Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: A Class: B Class: C Class: D Class: E
## Sensitivity            0.9994   0.9930   0.9854   0.9782   1.0000
## Specificity            0.9983   0.9968   0.9957   0.9998   0.9998
## Pos Pred Value         0.9958   0.9869   0.9797   0.9989   0.9991
## Neg Pred Value         0.9998   0.9983   0.9969   0.9957   1.0000
## Prevalence             0.2845   0.1935   0.1743   0.1638   0.1839
## Detection Rate         0.2843   0.1922   0.1718   0.1602   0.1839
## Detection Prevalence   0.2855   0.1947   0.1754   0.1604   0.1840
## Balanced Accuracy      0.9989   0.9949   0.9905   0.9890   0.9999
</code></pre>

<p>We can see some missclassification as well on the testing set. The estimated accuracy is 99.24% which is very good. We can confidently use this model for the prediction of the remaining data.</p>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Credits</h2>

<p>The data used in this analysis is provided by <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a> .</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/fatzh/PracticalMachineLearning-PeerAssignment">Practical Machine Learning</a> is maintained by <a href="https://github.com/fatzh">fatzh</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
